---
title: 'NDVI Assesment of Santa Clara River Plant Communities'
author: "Briana Barajas"
date: "December 15, 2023"
output: html_document
format: 
  html:
    code-fold: true
    code-summary: "View Code"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Background

While many organisms in nature experience phenological cycles, plant pheology is one of the most easily recognized. Phenological events for plants include leaf growth, flowering, and leaf death (also known as *senescence*). The timing of these events is based on climate conditions, so that plants may ensure successful reproduction. As the climate changes, phenological cycles in plants can be disrupted. For this reason, changes in plant phenology are used to estimate how ecosystems are responding to climate change.

This analysis utilizes satellite data to estimate the normalized difference vegetation index (NDVI) to examine plant phenology near the Santa Clara River. The Santa Clara River flows from Santa Clarita to Ventura, and remains relatively natural compared to other rivers in California. Additionally, the river provides water for agriculture, and habitat for several endangered plant and animal species. For these reasons, there have been significant efforts to conserve and restore the riparian habitat surrounding the river[^1]. With this in mind, I calculated and analyzed the phenology of the following plant communities:

[^1]: "Santa Clara River." *The Nature Conservancy*, www.nature.org/en-us/get-involved/how-to-help/places-we-protect/the-nature-conservancy-in-california-santa-clara-river-california-con/#:\~:text=The%20Santa%20Clara%20River%20is%20a%20vital%20source%20of%20drinking,bustling%20Los%20Angeles%2DVentura%20region. Accessed 15 Dec. 2023.

-   **riparian forests**: grow along the river, dominated by winter deciduous cottonwood and willow trees
-   **grasslands**: grow in openspaces, dominated by drought deciduous grasses
-   **chaparral shrublands**: grow in more arid habitats, dominated by evergreen shrubs

credit: this post is based on a materials developed by Chris Kibler, with additional assistance from Ruth Oliver

## About the Data

### River Data

A shape file of rivers in Ventura County is publicly available via the [Ventura County Watershed Protection District](https://ventura-county-watershed-protection-district-gis-data-vcwpd.hub.arcgis.com/search).

### Landsat Data

The data that will be used to calculate NDVI is from the Landsat Operational Land Imager (OLI) sensor. There are 8 total landsat `.tif` files which contain level 3 surface reflectance products where erroneous values were set to NA, scale factor is set to 100, and bands 2-7 are present. The date of collection is at the end of each file name.

### Study Sites

Study sites are available as vector data (polygons) with character strings as the plant type. This data will be used to classify the plant communities of interest.

## Compute Initial NDVI

NDVI was computed for all 8 Landsat images. The date range is between June 2018 and July, 2019. Ideally this will provide an accurate estimate of annual phonological changes in NDVI.

```{r, echo=FALSE}
library(terra)
library(sf)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(here)
library(tmap)
```

```{r, echo=FALSE}
1+1
```

**Preparation:**

```{r, results='hide'}
# create NDVI function
ndvi_fun = function(nir, red){
  (nir - red) / (nir + red)
}

# create list of landsat files
landsat_files <- list.files(here("data"), pattern = "*.tif", full.names = TRUE)
```

**NDVI Across Scenes:**

```{r}
#function reads in data, renames bands, and calc NDVI
create_ndvi_layer <- function(i){
  landsat <- rast(landsat_files[i]) #read in data 
  names(landsat) <- c("blue", "green", "red", "NIR", "SWIR1", "SWIR2") #rename bands
  ndvi <- lapp(landsat[[c(4, 3)]], fun = ndvi_fun) #NDVI
}

# stack raster with NDVI data using function above
all_ndvi <- c(create_ndvi_layer(1),
              create_ndvi_layer(2),
              create_ndvi_layer(3),
              create_ndvi_layer(4),
              create_ndvi_layer(5),
              create_ndvi_layer(6),
              create_ndvi_layer(7),
              create_ndvi_layer(8))

# add dates to corresponding layer
names(all_ndvi) <- c("2018-06-12",
                     "2018-08-15",
                     "2018-10-18",
                     "2018-11-03",
                     "2019-01-22",
                     "2019-02-23",
                     "2019-04-12",
                     "2019-07-01")
```

## Map Study Sites Along River

eep

```{r}

```
